class ot{constructor(t,e,r){this.eventTarget=t,this.eventName=e,this.eventOptions=r,this.unorderedBindings=new Set}connect(){this.eventTarget.addEventListener(this.eventName,this,this.eventOptions)}disconnect(){this.eventTarget.removeEventListener(this.eventName,this,this.eventOptions)}bindingConnected(t){this.unorderedBindings.add(t)}bindingDisconnected(t){this.unorderedBindings.delete(t)}handleEvent(t){const e=at(t);for(const r of this.bindings){if(e.immediatePropagationStopped)break;r.handleEvent(e)}}hasBindings(){return this.unorderedBindings.size>0}get bindings(){return Array.from(this.unorderedBindings).sort((t,e)=>{const r=t.index,i=e.index;return r<i?-1:r>i?1:0})}}function at(s){if("immediatePropagationStopped"in s)return s;{const{stopImmediatePropagation:t}=s;return Object.assign(s,{immediatePropagationStopped:!1,stopImmediatePropagation(){this.immediatePropagationStopped=!0,t.call(this)}})}}class ct{constructor(t){this.application=t,this.eventListenerMaps=new Map,this.started=!1}start(){this.started||(this.started=!0,this.eventListeners.forEach(t=>t.connect()))}stop(){this.started&&(this.started=!1,this.eventListeners.forEach(t=>t.disconnect()))}get eventListeners(){return Array.from(this.eventListenerMaps.values()).reduce((t,e)=>t.concat(Array.from(e.values())),[])}bindingConnected(t){this.fetchEventListenerForBinding(t).bindingConnected(t)}bindingDisconnected(t,e=!1){this.fetchEventListenerForBinding(t).bindingDisconnected(t),e&&this.clearEventListenersForBinding(t)}handleError(t,e,r={}){this.application.handleError(t,`Error ${e}`,r)}clearEventListenersForBinding(t){const e=this.fetchEventListenerForBinding(t);e.hasBindings()||(e.disconnect(),this.removeMappedEventListenerFor(t))}removeMappedEventListenerFor(t){const{eventTarget:e,eventName:r,eventOptions:i}=t,n=this.fetchEventListenerMapForEventTarget(e),o=this.cacheKey(r,i);n.delete(o),n.size==0&&this.eventListenerMaps.delete(e)}fetchEventListenerForBinding(t){const{eventTarget:e,eventName:r,eventOptions:i}=t;return this.fetchEventListener(e,r,i)}fetchEventListener(t,e,r){const i=this.fetchEventListenerMapForEventTarget(t),n=this.cacheKey(e,r);let o=i.get(n);return o||(o=this.createEventListener(t,e,r),i.set(n,o)),o}createEventListener(t,e,r){const i=new ot(t,e,r);return this.started&&i.connect(),i}fetchEventListenerMapForEventTarget(t){let e=this.eventListenerMaps.get(t);return e||(e=new Map,this.eventListenerMaps.set(t,e)),e}cacheKey(t,e){const r=[t];return Object.keys(e).sort().forEach(i=>{r.push(`${e[i]?"":"!"}${i}`)}),r.join(":")}}const lt={stop({event:s,value:t}){return t&&s.stopPropagation(),!0},prevent({event:s,value:t}){return t&&s.preventDefault(),!0},self({event:s,value:t,element:e}){return t?e===s.target:!0}},ht=/^(?:(?:([^.]+?)\+)?(.+?)(?:\.(.+?))?(?:@(window|document))?->)?(.+?)(?:#([^:]+?))(?::(.+))?$/;function ut(s){const e=s.trim().match(ht)||[];let r=e[2],i=e[3];return i&&!["keydown","keyup","keypress"].includes(r)&&(r+=`.${i}`,i=""),{eventTarget:dt(e[4]),eventName:r,eventOptions:e[7]?ft(e[7]):{},identifier:e[5],methodName:e[6],keyFilter:e[1]||i}}function dt(s){if(s=="window")return window;if(s=="document")return document}function ft(s){return s.split(":").reduce((t,e)=>Object.assign(t,{[e.replace(/^!/,"")]:!/^!/.test(e)}),{})}function pt(s){if(s==window)return"window";if(s==document)return"document"}function T(s){return s.replace(/(?:[_-])([a-z0-9])/g,(t,e)=>e.toUpperCase())}function F(s){return T(s.replace(/--/g,"-").replace(/__/g,"_"))}function O(s){return s.charAt(0).toUpperCase()+s.slice(1)}function X(s){return s.replace(/([A-Z])/g,(t,e)=>`-${e.toLowerCase()}`)}function mt(s){return s.match(/[^\s]+/g)||[]}function j(s){return s!=null}function _(s,t){return Object.prototype.hasOwnProperty.call(s,t)}const I=["meta","ctrl","alt","shift"];class gt{constructor(t,e,r,i){this.element=t,this.index=e,this.eventTarget=r.eventTarget||t,this.eventName=r.eventName||vt(t)||M("missing event name"),this.eventOptions=r.eventOptions||{},this.identifier=r.identifier||M("missing identifier"),this.methodName=r.methodName||M("missing method name"),this.keyFilter=r.keyFilter||"",this.schema=i}static forToken(t,e){return new this(t.element,t.index,ut(t.content),e)}toString(){const t=this.keyFilter?`.${this.keyFilter}`:"",e=this.eventTargetName?`@${this.eventTargetName}`:"";return`${this.eventName}${t}${e}->${this.identifier}#${this.methodName}`}shouldIgnoreKeyboardEvent(t){if(!this.keyFilter)return!1;const e=this.keyFilter.split("+");if(this.keyFilterDissatisfied(t,e))return!0;const r=e.filter(i=>!I.includes(i))[0];return r?(_(this.keyMappings,r)||M(`contains unknown key filter: ${this.keyFilter}`),this.keyMappings[r].toLowerCase()!==t.key.toLowerCase()):!1}shouldIgnoreMouseEvent(t){if(!this.keyFilter)return!1;const e=[this.keyFilter];return!!this.keyFilterDissatisfied(t,e)}get params(){const t={},e=new RegExp(`^data-${this.identifier}-(.+)-param$`,"i");for(const{name:r,value:i}of Array.from(this.element.attributes)){const n=r.match(e),o=n&&n[1];o&&(t[T(o)]=yt(i))}return t}get eventTargetName(){return pt(this.eventTarget)}get keyMappings(){return this.schema.keyMappings}keyFilterDissatisfied(t,e){const[r,i,n,o]=I.map(a=>e.includes(a));return t.metaKey!==r||t.ctrlKey!==i||t.altKey!==n||t.shiftKey!==o}}const V={a:()=>"click",button:()=>"click",form:()=>"submit",details:()=>"toggle",input:s=>s.getAttribute("type")=="submit"?"click":"input",select:()=>"change",textarea:()=>"input"};function vt(s){const t=s.tagName.toLowerCase();if(t in V)return V[t](s)}function M(s){throw new Error(s)}function yt(s){try{return JSON.parse(s)}catch{return s}}class bt{constructor(t,e){this.context=t,this.action=e}get index(){return this.action.index}get eventTarget(){return this.action.eventTarget}get eventOptions(){return this.action.eventOptions}get identifier(){return this.context.identifier}handleEvent(t){const e=this.prepareActionEvent(t);this.willBeInvokedByEvent(t)&&this.applyEventModifiers(e)&&this.invokeWithEvent(e)}get eventName(){return this.action.eventName}get method(){const t=this.controller[this.methodName];if(typeof t=="function")return t;throw new Error(`Action "${this.action}" references undefined method "${this.methodName}"`)}applyEventModifiers(t){const{element:e}=this.action,{actionDescriptorFilters:r}=this.context.application,{controller:i}=this.context;let n=!0;for(const[o,a]of Object.entries(this.eventOptions))if(o in r){const c=r[o];n=n&&c({name:o,value:a,event:t,element:e,controller:i})}else continue;return n}prepareActionEvent(t){return Object.assign(t,{params:this.action.params})}invokeWithEvent(t){const{target:e,currentTarget:r}=t;try{this.method.call(this.controller,t),this.context.logDebugActivity(this.methodName,{event:t,target:e,currentTarget:r,action:this.methodName})}catch(i){const{identifier:n,controller:o,element:a,index:c}=this,l={identifier:n,controller:o,element:a,index:c,event:t};this.context.handleError(i,`invoking action "${this.action}"`,l)}}willBeInvokedByEvent(t){const e=t.target;return t instanceof KeyboardEvent&&this.action.shouldIgnoreKeyboardEvent(t)||t instanceof MouseEvent&&this.action.shouldIgnoreMouseEvent(t)?!1:this.element===e?!0:e instanceof Element&&this.element.contains(e)?this.scope.containsElement(e):this.scope.containsElement(this.action.element)}get controller(){return this.context.controller}get methodName(){return this.action.methodName}get element(){return this.scope.element}get scope(){return this.context.scope}}class W{constructor(t,e){this.mutationObserverInit={attributes:!0,childList:!0,subtree:!0},this.element=t,this.started=!1,this.delegate=e,this.elements=new Set,this.mutationObserver=new MutationObserver(r=>this.processMutations(r))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,this.mutationObserverInit),this.refresh())}pause(t){this.started&&(this.mutationObserver.disconnect(),this.started=!1),t(),this.started||(this.mutationObserver.observe(this.element,this.mutationObserverInit),this.started=!0)}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started){const t=new Set(this.matchElementsInTree());for(const e of Array.from(this.elements))t.has(e)||this.removeElement(e);for(const e of Array.from(t))this.addElement(e)}}processMutations(t){if(this.started)for(const e of t)this.processMutation(e)}processMutation(t){t.type=="attributes"?this.processAttributeChange(t.target,t.attributeName):t.type=="childList"&&(this.processRemovedNodes(t.removedNodes),this.processAddedNodes(t.addedNodes))}processAttributeChange(t,e){this.elements.has(t)?this.delegate.elementAttributeChanged&&this.matchElement(t)?this.delegate.elementAttributeChanged(t,e):this.removeElement(t):this.matchElement(t)&&this.addElement(t)}processRemovedNodes(t){for(const e of Array.from(t)){const r=this.elementFromNode(e);r&&this.processTree(r,this.removeElement)}}processAddedNodes(t){for(const e of Array.from(t)){const r=this.elementFromNode(e);r&&this.elementIsActive(r)&&this.processTree(r,this.addElement)}}matchElement(t){return this.delegate.matchElement(t)}matchElementsInTree(t=this.element){return this.delegate.matchElementsInTree(t)}processTree(t,e){for(const r of this.matchElementsInTree(t))e.call(this,r)}elementFromNode(t){if(t.nodeType==Node.ELEMENT_NODE)return t}elementIsActive(t){return t.isConnected!=this.element.isConnected?!1:this.element.contains(t)}addElement(t){this.elements.has(t)||this.elementIsActive(t)&&(this.elements.add(t),this.delegate.elementMatched&&this.delegate.elementMatched(t))}removeElement(t){this.elements.has(t)&&(this.elements.delete(t),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(t))}}class Y{constructor(t,e,r){this.attributeName=e,this.delegate=r,this.elementObserver=new W(t,this)}get element(){return this.elementObserver.element}get selector(){return`[${this.attributeName}]`}start(){this.elementObserver.start()}pause(t){this.elementObserver.pause(t)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get started(){return this.elementObserver.started}matchElement(t){return t.hasAttribute(this.attributeName)}matchElementsInTree(t){const e=this.matchElement(t)?[t]:[],r=Array.from(t.querySelectorAll(this.selector));return e.concat(r)}elementMatched(t){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(t,this.attributeName)}elementUnmatched(t){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(t,this.attributeName)}elementAttributeChanged(t,e){this.delegate.elementAttributeValueChanged&&this.attributeName==e&&this.delegate.elementAttributeValueChanged(t,e)}}function Ot(s,t,e){G(s,t).add(e)}function Et(s,t,e){G(s,t).delete(e),At(s,t)}function G(s,t){let e=s.get(t);return e||(e=new Set,s.set(t,e)),e}function At(s,t){const e=s.get(t);e!=null&&e.size==0&&s.delete(t)}class p{constructor(){this.valuesByKey=new Map}get keys(){return Array.from(this.valuesByKey.keys())}get values(){return Array.from(this.valuesByKey.values()).reduce((e,r)=>e.concat(Array.from(r)),[])}get size(){return Array.from(this.valuesByKey.values()).reduce((e,r)=>e+r.size,0)}add(t,e){Ot(this.valuesByKey,t,e)}delete(t,e){Et(this.valuesByKey,t,e)}has(t,e){const r=this.valuesByKey.get(t);return r!=null&&r.has(e)}hasKey(t){return this.valuesByKey.has(t)}hasValue(t){return Array.from(this.valuesByKey.values()).some(r=>r.has(t))}getValuesForKey(t){const e=this.valuesByKey.get(t);return e?Array.from(e):[]}getKeysForValue(t){return Array.from(this.valuesByKey).filter(([e,r])=>r.has(t)).map(([e,r])=>e)}}class wt{constructor(t,e,r,i){this._selector=e,this.details=i,this.elementObserver=new W(t,this),this.delegate=r,this.matchesByElement=new p}get started(){return this.elementObserver.started}get selector(){return this._selector}set selector(t){this._selector=t,this.refresh()}start(){this.elementObserver.start()}pause(t){this.elementObserver.pause(t)}stop(){this.elementObserver.stop()}refresh(){this.elementObserver.refresh()}get element(){return this.elementObserver.element}matchElement(t){const{selector:e}=this;if(e){const r=t.matches(e);return this.delegate.selectorMatchElement?r&&this.delegate.selectorMatchElement(t,this.details):r}else return!1}matchElementsInTree(t){const{selector:e}=this;if(e){const r=this.matchElement(t)?[t]:[],i=Array.from(t.querySelectorAll(e)).filter(n=>this.matchElement(n));return r.concat(i)}else return[]}elementMatched(t){const{selector:e}=this;e&&this.selectorMatched(t,e)}elementUnmatched(t){const e=this.matchesByElement.getKeysForValue(t);for(const r of e)this.selectorUnmatched(t,r)}elementAttributeChanged(t,e){const{selector:r}=this;if(r){const i=this.matchElement(t),n=this.matchesByElement.has(r,t);i&&!n?this.selectorMatched(t,r):!i&&n&&this.selectorUnmatched(t,r)}}selectorMatched(t,e){this.delegate.selectorMatched(t,e,this.details),this.matchesByElement.add(e,t)}selectorUnmatched(t,e){this.delegate.selectorUnmatched(t,e,this.details),this.matchesByElement.delete(e,t)}}class Mt{constructor(t,e){this.element=t,this.delegate=e,this.started=!1,this.stringMap=new Map,this.mutationObserver=new MutationObserver(r=>this.processMutations(r))}start(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,attributeOldValue:!0}),this.refresh())}stop(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)}refresh(){if(this.started)for(const t of this.knownAttributeNames)this.refreshAttribute(t,null)}processMutations(t){if(this.started)for(const e of t)this.processMutation(e)}processMutation(t){const e=t.attributeName;e&&this.refreshAttribute(e,t.oldValue)}refreshAttribute(t,e){const r=this.delegate.getStringMapKeyForAttribute(t);if(r!=null){this.stringMap.has(t)||this.stringMapKeyAdded(r,t);const i=this.element.getAttribute(t);if(this.stringMap.get(t)!=i&&this.stringMapValueChanged(i,r,e),i==null){const n=this.stringMap.get(t);this.stringMap.delete(t),n&&this.stringMapKeyRemoved(r,t,n)}else this.stringMap.set(t,i)}}stringMapKeyAdded(t,e){this.delegate.stringMapKeyAdded&&this.delegate.stringMapKeyAdded(t,e)}stringMapValueChanged(t,e,r){this.delegate.stringMapValueChanged&&this.delegate.stringMapValueChanged(t,e,r)}stringMapKeyRemoved(t,e,r){this.delegate.stringMapKeyRemoved&&this.delegate.stringMapKeyRemoved(t,e,r)}get knownAttributeNames(){return Array.from(new Set(this.currentAttributeNames.concat(this.recordedAttributeNames)))}get currentAttributeNames(){return Array.from(this.element.attributes).map(t=>t.name)}get recordedAttributeNames(){return Array.from(this.stringMap.keys())}}class J{constructor(t,e,r){this.attributeObserver=new Y(t,e,this),this.delegate=r,this.tokensByElement=new p}get started(){return this.attributeObserver.started}start(){this.attributeObserver.start()}pause(t){this.attributeObserver.pause(t)}stop(){this.attributeObserver.stop()}refresh(){this.attributeObserver.refresh()}get element(){return this.attributeObserver.element}get attributeName(){return this.attributeObserver.attributeName}elementMatchedAttribute(t){this.tokensMatched(this.readTokensForElement(t))}elementAttributeValueChanged(t){const[e,r]=this.refreshTokensForElement(t);this.tokensUnmatched(e),this.tokensMatched(r)}elementUnmatchedAttribute(t){this.tokensUnmatched(this.tokensByElement.getValuesForKey(t))}tokensMatched(t){t.forEach(e=>this.tokenMatched(e))}tokensUnmatched(t){t.forEach(e=>this.tokenUnmatched(e))}tokenMatched(t){this.delegate.tokenMatched(t),this.tokensByElement.add(t.element,t)}tokenUnmatched(t){this.delegate.tokenUnmatched(t),this.tokensByElement.delete(t.element,t)}refreshTokensForElement(t){const e=this.tokensByElement.getValuesForKey(t),r=this.readTokensForElement(t),i=Ct(e,r).findIndex(([n,o])=>!Ft(n,o));return i==-1?[[],[]]:[e.slice(i),r.slice(i)]}readTokensForElement(t){const e=this.attributeName,r=t.getAttribute(e)||"";return Nt(r,t,e)}}function Nt(s,t,e){return s.trim().split(/\s+/).filter(r=>r.length).map((r,i)=>({element:t,attributeName:e,content:r,index:i}))}function Ct(s,t){const e=Math.max(s.length,t.length);return Array.from({length:e},(r,i)=>[s[i],t[i]])}function Ft(s,t){return s&&t&&s.index==t.index&&s.content==t.content}class Z{constructor(t,e,r){this.tokenListObserver=new J(t,e,this),this.delegate=r,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}get started(){return this.tokenListObserver.started}start(){this.tokenListObserver.start()}stop(){this.tokenListObserver.stop()}refresh(){this.tokenListObserver.refresh()}get element(){return this.tokenListObserver.element}get attributeName(){return this.tokenListObserver.attributeName}tokenMatched(t){const{element:e}=t,{value:r}=this.fetchParseResultForToken(t);r&&(this.fetchValuesByTokenForElement(e).set(t,r),this.delegate.elementMatchedValue(e,r))}tokenUnmatched(t){const{element:e}=t,{value:r}=this.fetchParseResultForToken(t);r&&(this.fetchValuesByTokenForElement(e).delete(t),this.delegate.elementUnmatchedValue(e,r))}fetchParseResultForToken(t){let e=this.parseResultsByToken.get(t);return e||(e=this.parseToken(t),this.parseResultsByToken.set(t,e)),e}fetchValuesByTokenForElement(t){let e=this.valuesByTokenByElement.get(t);return e||(e=new Map,this.valuesByTokenByElement.set(t,e)),e}parseToken(t){try{return{value:this.delegate.parseValueForToken(t)}}catch(e){return{error:e}}}}class _t{constructor(t,e){this.context=t,this.delegate=e,this.bindingsByAction=new Map}start(){this.valueListObserver||(this.valueListObserver=new Z(this.element,this.actionAttribute,this),this.valueListObserver.start())}stop(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())}get element(){return this.context.element}get identifier(){return this.context.identifier}get actionAttribute(){return this.schema.actionAttribute}get schema(){return this.context.schema}get bindings(){return Array.from(this.bindingsByAction.values())}connectAction(t){const e=new bt(this.context,t);this.bindingsByAction.set(t,e),this.delegate.bindingConnected(e)}disconnectAction(t){const e=this.bindingsByAction.get(t);e&&(this.bindingsByAction.delete(t),this.delegate.bindingDisconnected(e))}disconnectAllActions(){this.bindings.forEach(t=>this.delegate.bindingDisconnected(t,!0)),this.bindingsByAction.clear()}parseValueForToken(t){const e=gt.forToken(t,this.schema);if(e.identifier==this.identifier)return e}elementMatchedValue(t,e){this.connectAction(e)}elementUnmatchedValue(t,e){this.disconnectAction(e)}}class kt{constructor(t,e){this.context=t,this.receiver=e,this.stringMapObserver=new Mt(this.element,this),this.valueDescriptorMap=this.controller.valueDescriptorMap}start(){this.stringMapObserver.start(),this.invokeChangedCallbacksForDefaultValues()}stop(){this.stringMapObserver.stop()}get element(){return this.context.element}get controller(){return this.context.controller}getStringMapKeyForAttribute(t){if(t in this.valueDescriptorMap)return this.valueDescriptorMap[t].name}stringMapKeyAdded(t,e){const r=this.valueDescriptorMap[e];this.hasValue(t)||this.invokeChangedCallback(t,r.writer(this.receiver[t]),r.writer(r.defaultValue))}stringMapValueChanged(t,e,r){const i=this.valueDescriptorNameMap[e];t!==null&&(r===null&&(r=i.writer(i.defaultValue)),this.invokeChangedCallback(e,t,r))}stringMapKeyRemoved(t,e,r){const i=this.valueDescriptorNameMap[t];this.hasValue(t)?this.invokeChangedCallback(t,i.writer(this.receiver[t]),r):this.invokeChangedCallback(t,i.writer(i.defaultValue),r)}invokeChangedCallbacksForDefaultValues(){for(const{key:t,name:e,defaultValue:r,writer:i}of this.valueDescriptors)r!=null&&!this.controller.data.has(t)&&this.invokeChangedCallback(e,i(r),void 0)}invokeChangedCallback(t,e,r){const i=`${t}Changed`,n=this.receiver[i];if(typeof n=="function"){const o=this.valueDescriptorNameMap[t];try{const a=o.reader(e);let c=r;r&&(c=o.reader(r)),n.call(this.receiver,a,c)}catch(a){throw a instanceof TypeError&&(a.message=`Stimulus Value "${this.context.identifier}.${o.name}" - ${a.message}`),a}}}get valueDescriptors(){const{valueDescriptorMap:t}=this;return Object.keys(t).map(e=>t[e])}get valueDescriptorNameMap(){const t={};return Object.keys(this.valueDescriptorMap).forEach(e=>{const r=this.valueDescriptorMap[e];t[r.name]=r}),t}hasValue(t){const e=this.valueDescriptorNameMap[t],r=`has${O(e.name)}`;return this.receiver[r]}}class Tt{constructor(t,e){this.context=t,this.delegate=e,this.targetsByName=new p}start(){this.tokenListObserver||(this.tokenListObserver=new J(this.element,this.attributeName,this),this.tokenListObserver.start())}stop(){this.tokenListObserver&&(this.disconnectAllTargets(),this.tokenListObserver.stop(),delete this.tokenListObserver)}tokenMatched({element:t,content:e}){this.scope.containsElement(t)&&this.connectTarget(t,e)}tokenUnmatched({element:t,content:e}){this.disconnectTarget(t,e)}connectTarget(t,e){var r;this.targetsByName.has(e,t)||(this.targetsByName.add(e,t),(r=this.tokenListObserver)===null||r===void 0||r.pause(()=>this.delegate.targetConnected(t,e)))}disconnectTarget(t,e){var r;this.targetsByName.has(e,t)&&(this.targetsByName.delete(e,t),(r=this.tokenListObserver)===null||r===void 0||r.pause(()=>this.delegate.targetDisconnected(t,e)))}disconnectAllTargets(){for(const t of this.targetsByName.keys)for(const e of this.targetsByName.getValuesForKey(t))this.disconnectTarget(e,t)}get attributeName(){return`data-${this.context.identifier}-target`}get element(){return this.context.element}get scope(){return this.context.scope}}function E(s,t){const e=Q(s);return Array.from(e.reduce((r,i)=>(Lt(i,t).forEach(n=>r.add(n)),r),new Set))}function St(s,t){return Q(s).reduce((r,i)=>(r.push(...xt(i,t)),r),[])}function Q(s){const t=[];for(;s;)t.push(s),s=Object.getPrototypeOf(s);return t.reverse()}function Lt(s,t){const e=s[t];return Array.isArray(e)?e:[]}function xt(s,t){const e=s[t];return e?Object.keys(e).map(r=>[r,e[r]]):[]}class Bt{constructor(t,e){this.started=!1,this.context=t,this.delegate=e,this.outletsByName=new p,this.outletElementsByName=new p,this.selectorObserverMap=new Map,this.attributeObserverMap=new Map}start(){this.started||(this.outletDefinitions.forEach(t=>{this.setupSelectorObserverForOutlet(t),this.setupAttributeObserverForOutlet(t)}),this.started=!0,this.dependentContexts.forEach(t=>t.refresh()))}refresh(){this.selectorObserverMap.forEach(t=>t.refresh()),this.attributeObserverMap.forEach(t=>t.refresh())}stop(){this.started&&(this.started=!1,this.disconnectAllOutlets(),this.stopSelectorObservers(),this.stopAttributeObservers())}stopSelectorObservers(){this.selectorObserverMap.size>0&&(this.selectorObserverMap.forEach(t=>t.stop()),this.selectorObserverMap.clear())}stopAttributeObservers(){this.attributeObserverMap.size>0&&(this.attributeObserverMap.forEach(t=>t.stop()),this.attributeObserverMap.clear())}selectorMatched(t,e,{outletName:r}){const i=this.getOutlet(t,r);i&&this.connectOutlet(i,t,r)}selectorUnmatched(t,e,{outletName:r}){const i=this.getOutletFromMap(t,r);i&&this.disconnectOutlet(i,t,r)}selectorMatchElement(t,{outletName:e}){const r=this.selector(e),i=this.hasOutlet(t,e),n=t.matches(`[${this.schema.controllerAttribute}~=${e}]`);return r?i&&n&&t.matches(r):!1}elementMatchedAttribute(t,e){const r=this.getOutletNameFromOutletAttributeName(e);r&&this.updateSelectorObserverForOutlet(r)}elementAttributeValueChanged(t,e){const r=this.getOutletNameFromOutletAttributeName(e);r&&this.updateSelectorObserverForOutlet(r)}elementUnmatchedAttribute(t,e){const r=this.getOutletNameFromOutletAttributeName(e);r&&this.updateSelectorObserverForOutlet(r)}connectOutlet(t,e,r){var i;this.outletElementsByName.has(r,e)||(this.outletsByName.add(r,t),this.outletElementsByName.add(r,e),(i=this.selectorObserverMap.get(r))===null||i===void 0||i.pause(()=>this.delegate.outletConnected(t,e,r)))}disconnectOutlet(t,e,r){var i;this.outletElementsByName.has(r,e)&&(this.outletsByName.delete(r,t),this.outletElementsByName.delete(r,e),(i=this.selectorObserverMap.get(r))===null||i===void 0||i.pause(()=>this.delegate.outletDisconnected(t,e,r)))}disconnectAllOutlets(){for(const t of this.outletElementsByName.keys)for(const e of this.outletElementsByName.getValuesForKey(t))for(const r of this.outletsByName.getValuesForKey(t))this.disconnectOutlet(r,e,t)}updateSelectorObserverForOutlet(t){const e=this.selectorObserverMap.get(t);e&&(e.selector=this.selector(t))}setupSelectorObserverForOutlet(t){const e=this.selector(t),r=new wt(document.body,e,this,{outletName:t});this.selectorObserverMap.set(t,r),r.start()}setupAttributeObserverForOutlet(t){const e=this.attributeNameForOutletName(t),r=new Y(this.scope.element,e,this);this.attributeObserverMap.set(t,r),r.start()}selector(t){return this.scope.outlets.getSelectorForOutletName(t)}attributeNameForOutletName(t){return this.scope.schema.outletAttributeForScope(this.identifier,t)}getOutletNameFromOutletAttributeName(t){return this.outletDefinitions.find(e=>this.attributeNameForOutletName(e)===t)}get outletDependencies(){const t=new p;return this.router.modules.forEach(e=>{const r=e.definition.controllerConstructor;E(r,"outlets").forEach(n=>t.add(n,e.identifier))}),t}get outletDefinitions(){return this.outletDependencies.getKeysForValue(this.identifier)}get dependentControllerIdentifiers(){return this.outletDependencies.getValuesForKey(this.identifier)}get dependentContexts(){const t=this.dependentControllerIdentifiers;return this.router.contexts.filter(e=>t.includes(e.identifier))}hasOutlet(t,e){return!!this.getOutlet(t,e)||!!this.getOutletFromMap(t,e)}getOutlet(t,e){return this.application.getControllerForElementAndIdentifier(t,e)}getOutletFromMap(t,e){return this.outletsByName.getValuesForKey(e).find(r=>r.element===t)}get scope(){return this.context.scope}get schema(){return this.context.schema}get identifier(){return this.context.identifier}get application(){return this.context.application}get router(){return this.application.router}}class Dt{constructor(t,e){this.logDebugActivity=(r,i={})=>{const{identifier:n,controller:o,element:a}=this;i=Object.assign({identifier:n,controller:o,element:a},i),this.application.logDebugActivity(this.identifier,r,i)},this.module=t,this.scope=e,this.controller=new t.controllerConstructor(this),this.bindingObserver=new _t(this,this.dispatcher),this.valueObserver=new kt(this,this.controller),this.targetObserver=new Tt(this,this),this.outletObserver=new Bt(this,this);try{this.controller.initialize(),this.logDebugActivity("initialize")}catch(r){this.handleError(r,"initializing controller")}}connect(){this.bindingObserver.start(),this.valueObserver.start(),this.targetObserver.start(),this.outletObserver.start();try{this.controller.connect(),this.logDebugActivity("connect")}catch(t){this.handleError(t,"connecting controller")}}refresh(){this.outletObserver.refresh()}disconnect(){try{this.controller.disconnect(),this.logDebugActivity("disconnect")}catch(t){this.handleError(t,"disconnecting controller")}this.outletObserver.stop(),this.targetObserver.stop(),this.valueObserver.stop(),this.bindingObserver.stop()}get application(){return this.module.application}get identifier(){return this.module.identifier}get schema(){return this.application.schema}get dispatcher(){return this.application.dispatcher}get element(){return this.scope.element}get parentElement(){return this.element.parentElement}handleError(t,e,r={}){const{identifier:i,controller:n,element:o}=this;r=Object.assign({identifier:i,controller:n,element:o},r),this.application.handleError(t,`Error ${e}`,r)}targetConnected(t,e){this.invokeControllerMethod(`${e}TargetConnected`,t)}targetDisconnected(t,e){this.invokeControllerMethod(`${e}TargetDisconnected`,t)}outletConnected(t,e,r){this.invokeControllerMethod(`${F(r)}OutletConnected`,t,e)}outletDisconnected(t,e,r){this.invokeControllerMethod(`${F(r)}OutletDisconnected`,t,e)}invokeControllerMethod(t,...e){const r=this.controller;typeof r[t]=="function"&&r[t](...e)}}function $t(s){return jt(s,It(s))}function jt(s,t){const e=Rt(s),r=Vt(s.prototype,t);return Object.defineProperties(e.prototype,r),e}function It(s){return E(s,"blessings").reduce((e,r)=>{const i=r(s);for(const n in i){const o=e[n]||{};e[n]=Object.assign(o,i[n])}return e},{})}function Vt(s,t){return Pt(t).reduce((e,r)=>{const i=Kt(s,t,r);return i&&Object.assign(e,{[r]:i}),e},{})}function Kt(s,t,e){const r=Object.getOwnPropertyDescriptor(s,e);if(!(r&&"value"in r)){const n=Object.getOwnPropertyDescriptor(t,e).value;return r&&(n.get=r.get||n.get,n.set=r.set||n.set),n}}const Pt=typeof Object.getOwnPropertySymbols=="function"?s=>[...Object.getOwnPropertyNames(s),...Object.getOwnPropertySymbols(s)]:Object.getOwnPropertyNames,Rt=(()=>{function s(e){function r(){return Reflect.construct(e,arguments,new.target)}return r.prototype=Object.create(e.prototype,{constructor:{value:r}}),Reflect.setPrototypeOf(r,e),r}function t(){const r=s(function(){this.a.call(this)});return r.prototype.a=function(){},new r}try{return t(),s}catch{return r=>class extends r{}}})();function Ut(s){return{identifier:s.identifier,controllerConstructor:$t(s.controllerConstructor)}}class zt{constructor(t,e){this.application=t,this.definition=Ut(e),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}get identifier(){return this.definition.identifier}get controllerConstructor(){return this.definition.controllerConstructor}get contexts(){return Array.from(this.connectedContexts)}connectContextForScope(t){const e=this.fetchContextForScope(t);this.connectedContexts.add(e),e.connect()}disconnectContextForScope(t){const e=this.contextsByScope.get(t);e&&(this.connectedContexts.delete(e),e.disconnect())}fetchContextForScope(t){let e=this.contextsByScope.get(t);return e||(e=new Dt(this,t),this.contextsByScope.set(t,e)),e}}class Ht{constructor(t){this.scope=t}has(t){return this.data.has(this.getDataKey(t))}get(t){return this.getAll(t)[0]}getAll(t){const e=this.data.get(this.getDataKey(t))||"";return mt(e)}getAttributeName(t){return this.data.getAttributeNameForKey(this.getDataKey(t))}getDataKey(t){return`${t}-class`}get data(){return this.scope.data}}class qt{constructor(t){this.scope=t}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get(t){const e=this.getAttributeNameForKey(t);return this.element.getAttribute(e)}set(t,e){const r=this.getAttributeNameForKey(t);return this.element.setAttribute(r,e),this.get(t)}has(t){const e=this.getAttributeNameForKey(t);return this.element.hasAttribute(e)}delete(t){if(this.has(t)){const e=this.getAttributeNameForKey(t);return this.element.removeAttribute(e),!0}else return!1}getAttributeNameForKey(t){return`data-${this.identifier}-${X(t)}`}}class Xt{constructor(t){this.warnedKeysByObject=new WeakMap,this.logger=t}warn(t,e,r){let i=this.warnedKeysByObject.get(t);i||(i=new Set,this.warnedKeysByObject.set(t,i)),i.has(e)||(i.add(e),this.logger.warn(r,t))}}function k(s,t){return`[${s}~="${t}"]`}class Wt{constructor(t){this.scope=t}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(t){return this.find(t)!=null}find(...t){return t.reduce((e,r)=>e||this.findTarget(r)||this.findLegacyTarget(r),void 0)}findAll(...t){return t.reduce((e,r)=>[...e,...this.findAllTargets(r),...this.findAllLegacyTargets(r)],[])}findTarget(t){const e=this.getSelectorForTargetName(t);return this.scope.findElement(e)}findAllTargets(t){const e=this.getSelectorForTargetName(t);return this.scope.findAllElements(e)}getSelectorForTargetName(t){const e=this.schema.targetAttributeForScope(this.identifier);return k(e,t)}findLegacyTarget(t){const e=this.getLegacySelectorForTargetName(t);return this.deprecate(this.scope.findElement(e),t)}findAllLegacyTargets(t){const e=this.getLegacySelectorForTargetName(t);return this.scope.findAllElements(e).map(r=>this.deprecate(r,t))}getLegacySelectorForTargetName(t){const e=`${this.identifier}.${t}`;return k(this.schema.targetAttribute,e)}deprecate(t,e){if(t){const{identifier:r}=this,i=this.schema.targetAttribute,n=this.schema.targetAttributeForScope(r);this.guide.warn(t,`target:${e}`,`Please replace ${i}="${r}.${e}" with ${n}="${e}". The ${i} attribute is deprecated and will be removed in a future version of Stimulus.`)}return t}get guide(){return this.scope.guide}}class Yt{constructor(t,e){this.scope=t,this.controllerElement=e}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get schema(){return this.scope.schema}has(t){return this.find(t)!=null}find(...t){return t.reduce((e,r)=>e||this.findOutlet(r),void 0)}findAll(...t){return t.reduce((e,r)=>[...e,...this.findAllOutlets(r)],[])}getSelectorForOutletName(t){const e=this.schema.outletAttributeForScope(this.identifier,t);return this.controllerElement.getAttribute(e)}findOutlet(t){const e=this.getSelectorForOutletName(t);if(e)return this.findElement(e,t)}findAllOutlets(t){const e=this.getSelectorForOutletName(t);return e?this.findAllElements(e,t):[]}findElement(t,e){return this.scope.queryElements(t).filter(i=>this.matchesElement(i,t,e))[0]}findAllElements(t,e){return this.scope.queryElements(t).filter(i=>this.matchesElement(i,t,e))}matchesElement(t,e,r){const i=t.getAttribute(this.scope.schema.controllerAttribute)||"";return t.matches(e)&&i.split(" ").includes(r)}}class S{constructor(t,e,r,i){this.targets=new Wt(this),this.classes=new Ht(this),this.data=new qt(this),this.containsElement=n=>n.closest(this.controllerSelector)===this.element,this.schema=t,this.element=e,this.identifier=r,this.guide=new Xt(i),this.outlets=new Yt(this.documentScope,e)}findElement(t){return this.element.matches(t)?this.element:this.queryElements(t).find(this.containsElement)}findAllElements(t){return[...this.element.matches(t)?[this.element]:[],...this.queryElements(t).filter(this.containsElement)]}queryElements(t){return Array.from(this.element.querySelectorAll(t))}get controllerSelector(){return k(this.schema.controllerAttribute,this.identifier)}get isDocumentScope(){return this.element===document.documentElement}get documentScope(){return this.isDocumentScope?this:new S(this.schema,document.documentElement,this.identifier,this.guide.logger)}}class Gt{constructor(t,e,r){this.element=t,this.schema=e,this.delegate=r,this.valueListObserver=new Z(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}start(){this.valueListObserver.start()}stop(){this.valueListObserver.stop()}get controllerAttribute(){return this.schema.controllerAttribute}parseValueForToken(t){const{element:e,content:r}=t;return this.parseValueForElementAndIdentifier(e,r)}parseValueForElementAndIdentifier(t,e){const r=this.fetchScopesByIdentifierForElement(t);let i=r.get(e);return i||(i=this.delegate.createScopeForElementAndIdentifier(t,e),r.set(e,i)),i}elementMatchedValue(t,e){const r=(this.scopeReferenceCounts.get(e)||0)+1;this.scopeReferenceCounts.set(e,r),r==1&&this.delegate.scopeConnected(e)}elementUnmatchedValue(t,e){const r=this.scopeReferenceCounts.get(e);r&&(this.scopeReferenceCounts.set(e,r-1),r==1&&this.delegate.scopeDisconnected(e))}fetchScopesByIdentifierForElement(t){let e=this.scopesByIdentifierByElement.get(t);return e||(e=new Map,this.scopesByIdentifierByElement.set(t,e)),e}}class Jt{constructor(t){this.application=t,this.scopeObserver=new Gt(this.element,this.schema,this),this.scopesByIdentifier=new p,this.modulesByIdentifier=new Map}get element(){return this.application.element}get schema(){return this.application.schema}get logger(){return this.application.logger}get controllerAttribute(){return this.schema.controllerAttribute}get modules(){return Array.from(this.modulesByIdentifier.values())}get contexts(){return this.modules.reduce((t,e)=>t.concat(e.contexts),[])}start(){this.scopeObserver.start()}stop(){this.scopeObserver.stop()}loadDefinition(t){this.unloadIdentifier(t.identifier);const e=new zt(this.application,t);this.connectModule(e);const r=t.controllerConstructor.afterLoad;r&&r.call(t.controllerConstructor,t.identifier,this.application)}unloadIdentifier(t){const e=this.modulesByIdentifier.get(t);e&&this.disconnectModule(e)}getContextForElementAndIdentifier(t,e){const r=this.modulesByIdentifier.get(e);if(r)return r.contexts.find(i=>i.element==t)}proposeToConnectScopeForElementAndIdentifier(t,e){const r=this.scopeObserver.parseValueForElementAndIdentifier(t,e);r?this.scopeObserver.elementMatchedValue(r.element,r):console.error(`Couldn't find or create scope for identifier: "${e}" and element:`,t)}handleError(t,e,r){this.application.handleError(t,e,r)}createScopeForElementAndIdentifier(t,e){return new S(this.schema,t,e,this.logger)}scopeConnected(t){this.scopesByIdentifier.add(t.identifier,t);const e=this.modulesByIdentifier.get(t.identifier);e&&e.connectContextForScope(t)}scopeDisconnected(t){this.scopesByIdentifier.delete(t.identifier,t);const e=this.modulesByIdentifier.get(t.identifier);e&&e.disconnectContextForScope(t)}connectModule(t){this.modulesByIdentifier.set(t.identifier,t),this.scopesByIdentifier.getValuesForKey(t.identifier).forEach(r=>t.connectContextForScope(r))}disconnectModule(t){this.modulesByIdentifier.delete(t.identifier),this.scopesByIdentifier.getValuesForKey(t.identifier).forEach(r=>t.disconnectContextForScope(r))}}const Zt={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target",targetAttributeForScope:s=>`data-${s}-target`,outletAttributeForScope:(s,t)=>`data-${s}-${t}-outlet`,keyMappings:Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},K("abcdefghijklmnopqrstuvwxyz".split("").map(s=>[s,s]))),K("0123456789".split("").map(s=>[s,s])))};function K(s){return s.reduce((t,[e,r])=>Object.assign(Object.assign({},t),{[e]:r}),{})}class Qt{constructor(t=document.documentElement,e=Zt){this.logger=console,this.debug=!1,this.logDebugActivity=(r,i,n={})=>{this.debug&&this.logFormattedMessage(r,i,n)},this.element=t,this.schema=e,this.dispatcher=new ct(this),this.router=new Jt(this),this.actionDescriptorFilters=Object.assign({},lt)}static start(t,e){const r=new this(t,e);return r.start(),r}async start(){await te(),this.logDebugActivity("application","starting"),this.dispatcher.start(),this.router.start(),this.logDebugActivity("application","start")}stop(){this.logDebugActivity("application","stopping"),this.dispatcher.stop(),this.router.stop(),this.logDebugActivity("application","stop")}register(t,e){this.load({identifier:t,controllerConstructor:e})}registerActionOption(t,e){this.actionDescriptorFilters[t]=e}load(t,...e){(Array.isArray(t)?t:[t,...e]).forEach(i=>{i.controllerConstructor.shouldLoad&&this.router.loadDefinition(i)})}unload(t,...e){(Array.isArray(t)?t:[t,...e]).forEach(i=>this.router.unloadIdentifier(i))}get controllers(){return this.router.contexts.map(t=>t.controller)}getControllerForElementAndIdentifier(t,e){const r=this.router.getContextForElementAndIdentifier(t,e);return r?r.controller:null}handleError(t,e,r){var i;this.logger.error(`%s

%o

%o`,e,t,r),(i=window.onerror)===null||i===void 0||i.call(window,e,"",0,0,t)}logFormattedMessage(t,e,r={}){r=Object.assign({application:this},r),this.logger.groupCollapsed(`${t} #${e}`),this.logger.log("details:",Object.assign({},r)),this.logger.groupEnd()}}function te(){return new Promise(s=>{document.readyState=="loading"?document.addEventListener("DOMContentLoaded",()=>s()):s()})}function ee(s){return E(s,"classes").reduce((e,r)=>Object.assign(e,re(r)),{})}function re(s){return{[`${s}Class`]:{get(){const{classes:t}=this;if(t.has(s))return t.get(s);{const e=t.getAttributeName(s);throw new Error(`Missing attribute "${e}"`)}}},[`${s}Classes`]:{get(){return this.classes.getAll(s)}},[`has${O(s)}Class`]:{get(){return this.classes.has(s)}}}}function se(s){return E(s,"outlets").reduce((e,r)=>Object.assign(e,ie(r)),{})}function P(s,t,e){return s.application.getControllerForElementAndIdentifier(t,e)}function R(s,t,e){let r=P(s,t,e);if(r||(s.application.router.proposeToConnectScopeForElementAndIdentifier(t,e),r=P(s,t,e),r))return r}function ie(s){const t=F(s);return{[`${t}Outlet`]:{get(){const e=this.outlets.find(s),r=this.outlets.getSelectorForOutletName(s);if(e){const i=R(this,e,s);if(i)return i;throw new Error(`The provided outlet element is missing an outlet controller "${s}" instance for host controller "${this.identifier}"`)}throw new Error(`Missing outlet element "${s}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${r}".`)}},[`${t}Outlets`]:{get(){const e=this.outlets.findAll(s);return e.length>0?e.map(r=>{const i=R(this,r,s);if(i)return i;console.warn(`The provided outlet element is missing an outlet controller "${s}" instance for host controller "${this.identifier}"`,r)}).filter(r=>r):[]}},[`${t}OutletElement`]:{get(){const e=this.outlets.find(s),r=this.outlets.getSelectorForOutletName(s);if(e)return e;throw new Error(`Missing outlet element "${s}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${r}".`)}},[`${t}OutletElements`]:{get(){return this.outlets.findAll(s)}},[`has${O(t)}Outlet`]:{get(){return this.outlets.has(s)}}}}function ne(s){return E(s,"targets").reduce((e,r)=>Object.assign(e,oe(r)),{})}function oe(s){return{[`${s}Target`]:{get(){const t=this.targets.find(s);if(t)return t;throw new Error(`Missing target element "${s}" for "${this.identifier}" controller`)}},[`${s}Targets`]:{get(){return this.targets.findAll(s)}},[`has${O(s)}Target`]:{get(){return this.targets.has(s)}}}}function ae(s){const t=St(s,"values"),e={valueDescriptorMap:{get(){return t.reduce((r,i)=>{const n=tt(i,this.identifier),o=this.data.getAttributeNameForKey(n.key);return Object.assign(r,{[o]:n})},{})}}};return t.reduce((r,i)=>Object.assign(r,ce(i)),e)}function ce(s,t){const e=tt(s,t),{key:r,name:i,reader:n,writer:o}=e;return{[i]:{get(){const a=this.data.get(r);return a!==null?n(a):e.defaultValue},set(a){a===void 0?this.data.delete(r):this.data.set(r,o(a))}},[`has${O(i)}`]:{get(){return this.data.has(r)||e.hasCustomDefaultValue}}}}function tt([s,t],e){return de({controller:e,token:s,typeDefinition:t})}function C(s){switch(s){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function b(s){switch(typeof s){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}if(Array.isArray(s))return"array";if(Object.prototype.toString.call(s)==="[object Object]")return"object"}function le(s){const{controller:t,token:e,typeObject:r}=s,i=j(r.type),n=j(r.default),o=i&&n,a=i&&!n,c=!i&&n,l=C(r.type),d=b(s.typeObject.default);if(a)return l;if(c)return d;if(l!==d){const A=t?`${t}.${e}`:e;throw new Error(`The specified default value for the Stimulus Value "${A}" must match the defined type "${l}". The provided default value of "${r.default}" is of type "${d}".`)}if(o)return l}function he(s){const{controller:t,token:e,typeDefinition:r}=s,n=le({controller:t,token:e,typeObject:r}),o=b(r),a=C(r),c=n||o||a;if(c)return c;const l=t?`${t}.${r}`:e;throw new Error(`Unknown value type "${l}" for "${e}" value`)}function ue(s){const t=C(s);if(t)return U[t];const e=_(s,"default"),r=_(s,"type"),i=s;if(e)return i.default;if(r){const{type:n}=i,o=C(n);if(o)return U[o]}return s}function de(s){const{token:t,typeDefinition:e}=s,r=`${X(t)}-value`,i=he(s);return{type:i,key:r,name:T(r),get defaultValue(){return ue(e)},get hasCustomDefaultValue(){return b(e)!==void 0},reader:fe[i],writer:z[i]||z.default}}const U={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},fe={array(s){const t=JSON.parse(s);if(!Array.isArray(t))throw new TypeError(`expected value of type "array" but instead got value "${s}" of type "${b(t)}"`);return t},boolean(s){return!(s=="0"||String(s).toLowerCase()=="false")},number(s){return Number(s.replace(/_/g,""))},object(s){const t=JSON.parse(s);if(t===null||typeof t!="object"||Array.isArray(t))throw new TypeError(`expected value of type "object" but instead got value "${s}" of type "${b(t)}"`);return t},string(s){return s}},z={default:pe,array:H,object:H};function H(s){return JSON.stringify(s)}function pe(s){return`${s}`}class m{constructor(t){this.context=t}static get shouldLoad(){return!0}static afterLoad(t,e){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:e=this.element,detail:r={},prefix:i=this.identifier,bubbles:n=!0,cancelable:o=!0}={}){const a=i?`${i}:${t}`:t,c=new CustomEvent(a,{detail:r,bubbles:n,cancelable:o});return e.dispatchEvent(c),c}}m.blessings=[ee,ne,ae,se];m.targets=[];m.outlets=[];m.values={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var h=function(){return h=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},h.apply(this,arguments)},me=function(){function s(t){this.options=t,this.listeners={}}return s.prototype.on=function(t,e){var r=this.listeners[t]||[];this.listeners[t]=r.concat([e])},s.prototype.triggerEvent=function(t,e){var r=this,i=this.listeners[t]||[];i.forEach(function(n){return n({target:r,event:e})})},s}(),g;(function(s){s[s.Add=0]="Add",s[s.Remove=1]="Remove"})(g||(g={}));var ge=function(){function s(){this.notifications=[]}return s.prototype.push=function(t){this.notifications.push(t),this.updateFn(t,g.Add,this.notifications)},s.prototype.splice=function(t,e){var r=this.notifications.splice(t,e)[0];return this.updateFn(r,g.Remove,this.notifications),r},s.prototype.indexOf=function(t){return this.notifications.indexOf(t)},s.prototype.onUpdate=function(t){this.updateFn=t},s}(),u;(function(s){s.Dismiss="dismiss",s.Click="click"})(u||(u={}));var q={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},ve=function(){function s(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var t=document.createDocumentFragment(),e=this._createHTMLElement({tagName:"div",className:"notyf"});t.appendChild(e),document.body.appendChild(t),this.container=e,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return s.prototype.on=function(t,e){var r;this.events=h(h({},this.events),(r={},r[t]=e,r))},s.prototype.update=function(t,e){e===g.Add?this.addNotification(t):e===g.Remove&&this.removeNotification(t)},s.prototype.removeNotification=function(t){var e=this,r=this._popRenderedNotification(t),i;if(r){i=r.node,i.classList.add("notyf__toast--disappear");var n;i.addEventListener(this.animationEndEventName,n=function(o){o.target===i&&(i.removeEventListener(e.animationEndEventName,n),e.container.removeChild(i))})}},s.prototype.addNotification=function(t){var e=this._renderNotification(t);this.notifications.push({notification:t,node:e}),this._announce(t.options.message||"Notification")},s.prototype._renderNotification=function(t){var e,r=this._buildNotificationCard(t),i=t.options.className;return i&&(e=r.classList).add.apply(e,i.split(" ")),this.container.appendChild(r),r},s.prototype._popRenderedNotification=function(t){for(var e=-1,r=0;r<this.notifications.length&&e<0;r++)this.notifications[r].notification===t&&(e=r);if(e!==-1)return this.notifications.splice(e,1)[0]},s.prototype.getXPosition=function(t){var e;return((e=t?.position)===null||e===void 0?void 0:e.x)||"right"},s.prototype.getYPosition=function(t){var e;return((e=t?.position)===null||e===void 0?void 0:e.y)||"bottom"},s.prototype.adjustContainerAlignment=function(t){var e=this.X_POSITION_FLEX_MAP[this.getXPosition(t)],r=this.Y_POSITION_FLEX_MAP[this.getYPosition(t)],i=this.container.style;i.setProperty("justify-content",r),i.setProperty("align-items",e)},s.prototype._buildNotificationCard=function(t){var e=this,r=t.options,i=r.icon;this.adjustContainerAlignment(r);var n=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),a=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),c=this._createHTMLElement({tagName:"div",className:"notyf__message"});c.innerHTML=r.message||"";var l=r.background||r.backgroundColor;if(i){var d=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(d.innerHTML=new String(i).valueOf()),typeof i=="object"){var A=i.tagName,rt=A===void 0?"i":A,st=i.className,it=i.text,L=i.color,x=L===void 0?l:L,B=this._createHTMLElement({tagName:rt,className:st,text:it});x&&(B.style.color=x),d.appendChild(B)}a.appendChild(d)}if(a.appendChild(c),n.appendChild(a),l&&(r.ripple?(o.style.background=l,n.appendChild(o)):n.style.background=l),r.dismissible){var D=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),$=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});D.appendChild($),a.appendChild(D),n.classList.add("notyf__toast--dismissible"),$.addEventListener("click",function(w){var v,f;(f=(v=e.events)[u.Dismiss])===null||f===void 0||f.call(v,{target:t,event:w}),w.stopPropagation()})}n.addEventListener("click",function(w){var v,f;return(f=(v=e.events)[u.Click])===null||f===void 0?void 0:f.call(v,{target:t,event:w})});var nt=this.getYPosition(r)==="top"?"upper":"lower";return n.classList.add("notyf__toast--"+nt),n},s.prototype._createHTMLElement=function(t){var e=t.tagName,r=t.className,i=t.text,n=document.createElement(e);return r&&(n.className=r),n.textContent=i||null,n},s.prototype._createA11yContainer=function(){var t=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});t.setAttribute("aria-atomic","true"),t.setAttribute("aria-live","polite"),t.style.border="0",t.style.clip="rect(0 0 0 0)",t.style.height="1px",t.style.margin="-1px",t.style.overflow="hidden",t.style.padding="0",t.style.position="absolute",t.style.width="1px",t.style.outline="0",document.body.appendChild(t),this.a11yContainer=t},s.prototype._announce=function(t){var e=this;this.a11yContainer.textContent="",setTimeout(function(){e.a11yContainer.textContent=t},100)},s.prototype._getAnimationEndEventName=function(){var t=document.createElement("_fake"),e={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},r;for(r in e)if(t.style[r]!==void 0)return e[r];return"animationend"},s}(),ye=function(){function s(t){var e=this;this.dismiss=this._removeNotification,this.notifications=new ge,this.view=new ve;var r=this.registerTypes(t);this.options=h(h({},q),t),this.options.types=r,this.notifications.onUpdate(function(i,n){return e.view.update(i,n)}),this.view.on(u.Dismiss,function(i){var n=i.target,o=i.event;e._removeNotification(n),n.triggerEvent(u.Dismiss,o)}),this.view.on(u.Click,function(i){var n=i.target,o=i.event;return n.triggerEvent(u.Click,o)})}return s.prototype.error=function(t){var e=this.normalizeOptions("error",t);return this.open(e)},s.prototype.success=function(t){var e=this.normalizeOptions("success",t);return this.open(e)},s.prototype.open=function(t){var e=this.options.types.find(function(n){var o=n.type;return o===t.type})||{},r=h(h({},e),t);this.assignProps(["ripple","position","dismissible"],r);var i=new me(r);return this._pushNotification(i),i},s.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},s.prototype.assignProps=function(t,e){var r=this;t.forEach(function(i){e[i]=e[i]==null?r.options[i]:e[i]})},s.prototype._pushNotification=function(t){var e=this;this.notifications.push(t);var r=t.options.duration!==void 0?t.options.duration:this.options.duration;r&&setTimeout(function(){return e._removeNotification(t)},r)},s.prototype._removeNotification=function(t){var e=this.notifications.indexOf(t);e!==-1&&this.notifications.splice(e,1)},s.prototype.normalizeOptions=function(t,e){var r={type:t};return typeof e=="string"?r.message=e:typeof e=="object"&&(r=h(h({},r),e)),r},s.prototype.registerTypes=function(t){var e=(t&&t.types||[]).slice(),r=q.types.map(function(i){var n=-1;e.forEach(function(a,c){a.type===i.type&&(n=c)});var o=n!==-1?e.splice(n,1)[0]:{};return h(h({},i),o)});return r.concat(e)},s}();let N;const y=()=>N||(N=new ye({riple:!1,dismissible:!0,duration:2e3,types:[{type:"success",background:"black"}]}),N),et=async s=>{try{if(navigator.clipboard)await navigator.clipboard.writeText(s);else{const t=document.createElement("textarea");t.value=s,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}y().success("Link copied to clipboard!")}catch(t){y().error(t.message)}};class be extends m{static values={id:String,universalLink:String};async share(){const t=this.universalLinkValue;if(!t){console.error("Universal link not found");return}try{if(navigator.share){await navigator.share({title:"Share this universal link",url:t});return}await et(t)}catch(e){console.error(e)}}}const Oe=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),Ee=/^https:\/\/(open\.spotify\.com\/(track|album|playlist|artist|episode|show)|spotify\.link)\/(\w{11,24})(?:[\?#].*)?$/,Ae=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be|music\.youtube\.com)\/(?:watch\?v=|embed\/|v\/|shorts\/|playlist\?list=|channel\/)?([\w-]{11,})(?:\S+)?(?:&si=\S+)?/;class we extends m{static targets=["form","link"];initialize(){document.addEventListener("htmx:afterOnLoad",()=>{const t=new URLSearchParams(window.location.search),e=this.element.querySelector('[data-controller="search-card"]')?.getAttribute("data-search-card-id-value");e&&(t.set("id",e),window.history.replaceState({},"",`${window.location.pathname}?${t}`))}),document.addEventListener("htmx:timeout",function(){y().error("Something went wrong, please try again later.")})}async submitFromClipboard(){if("clipboard"in navigator){const t=new URLSearchParams(window.location.search);try{(await navigator.clipboard.readText()).match(new RegExp(`${Ee.source}|${Ae.source}`))&&!t.get("id")&&(this.linkTarget.value=link,this.formTarget.submit())}catch{y().error("Clipboard access error")}}else y().error("Feature not supported in your browser")}}const Me=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));class Ne extends m{static values={url:String};share(){et(this.urlValue)}}const Ce=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));var Fe=/^(?:.*?(?:controllers|components)\/|\.?\.\/)?(.+)(?:[/_-]controller\..+?)$/;function _e(s,t){s.load(ke(t))}function ke(s){return Object.entries(s).map(Te).filter(t=>t)}function Te([s,t]){var e;const r=Se(s),i=(e=t.default)!=null?e:t;if(r&&typeof i=="function")return{identifier:r,controllerConstructor:i}}function Se(s){const t=(s.match(Fe)||[])[1];if(t)return t.replace(/_/g,"-").replace(/\//g,"--")}const Le=Qt.start(),xe=Object.assign({"./search_card_controller.js":Oe,"./search_controller.js":Me,"./search_link_controller.js":Ce});_e(Le,xe);
